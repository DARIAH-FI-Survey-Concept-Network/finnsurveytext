<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Extra-UseWithSurveyPackage • finnsurveytext</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Extra-UseWithSurveyPackage">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">finnsurveytext</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../../articles/web_only/Extra-AnalysingOtherLanguages.html">Extra-AnalysingOtherLanguages</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/Extra-UseWithSurveyPackage.html">Extra-UseWithSurveyPackage</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/InDetail1-DataPreparation.html">InDetail1-DataPreparation</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/InDetail2-DataExploration.html">InDetail2-DataExploration</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/InDetail3-ConceptNetworkOverview.html">InDetail3-ConceptNetworkOverview</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/InDetail4-ComparisonFunctions.html">InDetail4-ComparisonFunctions</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/InDetail5-AnalysisExample1.html">InDetail5-AnalysisExample1</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/InDetail6-AnalysisExample2.html">InDetail6-AnalysisExample2</a></li>
    <li><a class="dropdown-item" href="../../articles/Overview-PackageTutorial.html">Overview-PackageTutorial</a></li>
    <li><a class="dropdown-item" href="../../articles/ReadMe.html">ReadMe</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/DARIAH-FI-Survey-Concept-Network/finnsurveytext/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Extra-UseWithSurveyPackage</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DARIAH-FI-Survey-Concept-Network/finnsurveytext/blob/main/vignettes/web_only/Extra-UseWithSurveyPackage.Rmd" class="external-link"><code>vignettes/web_only/Extra-UseWithSurveyPackage.Rmd</code></a></small>
      <div class="d-none name"><code>Extra-UseWithSurveyPackage.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dariah-fi-survey-concept-network.github.io/finnsurveytext/">finnsurveytext</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The new updated version of <code>finnsurveytext</code> works with
<code>svydesign</code> objects which can be created with the
<code>survey</code> R <a href="https://cran.r-project.org/package=survey" class="external-link">package</a>. There are
two ways that svydesign objects can be used:</p>
<ol style="list-style-type: decimal">
<li>As an input during the pre-processing of your data.</li>
<li>As a way to add weights and additional columns within data
exploration and comparison functions</li>
</ol>
<div class="section level5">
<h5 id="first-lets-create-a-svydesign-object-for-use-in-this-tutorial">First, let’s create a <code>svydesign</code> object for use in this
tutorial:<a class="anchor" aria-label="anchor" href="#first-lets-create-a-svydesign-object-for-use-in-this-tutorial"></a>
</h5>
<p>We will use the <code>dev_coop</code> sample dataset for the
tutorial, and create a <code>svydesign</code> object from this sample
data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">svy_d</span> <span class="op">&lt;-</span> <span class="fu">survey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>id <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, </span>
<span>                           weights <span class="op">=</span> <span class="op">~</span><span class="va">paino</span>, </span>
<span>                           data <span class="op">=</span> <span class="va">dev_coop</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="option-1-formatting-data-using-svydesign-object">Option 1: Formatting data using svydesign object<a class="anchor" aria-label="anchor" href="#option-1-formatting-data-using-svydesign-object"></a>
</h2>
<p>The relevant function here is
<code><a href="../../reference/fst_prepare_svydesign.html">fst_prepare_svydesign()</a></code>.</p>
<div class="section level4">
<h4 id="explanation-of-parameters">Explanation of parameters:<a class="anchor" aria-label="anchor" href="#explanation-of-parameters"></a>
</h4>
<ul>
<li>
<code>svydesign</code>: the name of the svydesign object</li>
<li>
<code>question</code>: the column of ‘data’ that contains the
open-ended question</li>
<li>
<code>id</code>: the ID column in ‘data’ <code>model</code>: a
Finnish language model available for udpipe, “ftb” or “tdt”. (If you do
not provide a value, this will default to “ftb”.)</li>
<li>
<code>stopword_list</code>: a list of stopwords to remove from your
‘data’. (To find relevant stopwords lists, you can run
<code><a href="../../reference/fst_find_stopwords.html">fst_find_stopwords()</a></code>. If you do not provide a value, this
will default to “nltk”. “manual” can be used to indicate that a manual
list will be provided.)</li>
<li>
<code>use_weights</code>: optional, a boolean as to whether to
include weights from the svydesign. (If you do not provide a value, this
will default to TRUE.)</li>
<li>
<code>add_columns</code>: any columns you want to add to the
formatted data from the svydesign object, such as for use in comparison
functions. (If you do not provide any values, this will default to
NULL.)</li>
<li>
<code>manual</code>: an optional boolean to indicate that a manual
list will be provided. (<code>stopword_list = "manual"</code> can also
or instead be used. If you do not provide any values, this will default
to FALSE.)</li>
<li>
<code>manual_list</code>: the manual list of stopwords if you choose
to provide one. (If you do not provide any values, this will default to
an empty list.)</li>
</ul>
</div>
<div class="section level4">
<h4 id="lets-prepare-our-data-below">Let’s prepare our data below:<a class="anchor" aria-label="anchor" href="#lets-prepare-our-data-below"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/fst_prepare_svydesign.html">fst_prepare_svydesign</a></span><span class="op">(</span>svydesign <span class="op">=</span> <span class="va">svy_d</span>,</span>
<span>                            question <span class="op">=</span> <span class="st">'q11_3'</span>,</span>
<span>                            id <span class="op">=</span> <span class="st">'fsd_id'</span>,</span>
<span>                            model <span class="op">=</span> <span class="st">'tdt'</span>,</span>
<span>                            stopword_list <span class="op">=</span> <span class="st">'snowball'</span>,</span>
<span>                            use_weights <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            add_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'gender'</span>,<span class="st">'region'</span><span class="op">)</span></span>
<span>                            <span class="op">)</span></span></code></pre></div>
<p>The data is now formatted:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="2%">
<col width="4%">
<col width="3%">
<col width="24%">
<col width="2%">
<col width="5%">
<col width="5%">
<col width="1%">
<col width="1%">
<col width="23%">
<col width="4%">
<col width="3%">
<col width="1%">
<col width="4%">
<col width="2%">
<col width="2%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">doc_id</th>
<th align="right">paragraph_id</th>
<th align="right">sentence_id</th>
<th align="left">sentence</th>
<th align="left">token_id</th>
<th align="left">token</th>
<th align="left">lemma</th>
<th align="left">upos</th>
<th align="left">xpos</th>
<th align="left">feats</th>
<th align="left">head_token_id</th>
<th align="left">dep_rel</th>
<th align="left">deps</th>
<th align="left">misc</th>
<th align="right">weight</th>
<th align="left">gender</th>
<th align="left">region</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">saastuminen ja luonnonvarojen liikakäyttö, nälänhätä ja
ylikansoittuminen</td>
<td align="left">1</td>
<td align="left">saastuminen</td>
<td align="left">saastuminen</td>
<td align="left">NOUN</td>
<td align="left">N</td>
<td align="left">Case=Nom|Derivation=Minen|Number=Sing</td>
<td align="left">0</td>
<td align="left">root</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">0.544</td>
<td align="left">Female</td>
<td align="left">Muu Etelä-Suomi</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">saastuminen ja luonnonvarojen liikakäyttö, nälänhätä ja
ylikansoittuminen</td>
<td align="left">3</td>
<td align="left">luonnonvarojen</td>
<td align="left">luonnonvara</td>
<td align="left">NOUN</td>
<td align="left">N</td>
<td align="left">Case=Gen|Number=Plur</td>
<td align="left">4</td>
<td align="left">nmod:poss</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">0.544</td>
<td align="left">Female</td>
<td align="left">Muu Etelä-Suomi</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">saastuminen ja luonnonvarojen liikakäyttö, nälänhätä ja
ylikansoittuminen</td>
<td align="left">4</td>
<td align="left">liikakäyttö</td>
<td align="left">liikakäyttö</td>
<td align="left">NOUN</td>
<td align="left">N</td>
<td align="left">Case=Nom|Number=Sing</td>
<td align="left">1</td>
<td align="left">conj</td>
<td align="left">NA</td>
<td align="left">SpaceAfter=No</td>
<td align="right">0.544</td>
<td align="left">Female</td>
<td align="left">Muu Etelä-Suomi</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">saastuminen ja luonnonvarojen liikakäyttö, nälänhätä ja
ylikansoittuminen</td>
<td align="left">6</td>
<td align="left">nälänhätä</td>
<td align="left">nälänhä</td>
<td align="left">VERB</td>
<td align="left">V</td>
<td align="left">Mood=Imp|Number=Sing|Person=2|VerbForm=Fin|Voice=Act</td>
<td align="left">1</td>
<td align="left">conj</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">0.544</td>
<td align="left">Female</td>
<td align="left">Muu Etelä-Suomi</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">saastuminen ja luonnonvarojen liikakäyttö, nälänhätä ja
ylikansoittuminen</td>
<td align="left">8</td>
<td align="left">ylikansoittuminen</td>
<td align="left">ylikansoittuminen</td>
<td align="left">NOUN</td>
<td align="left">N</td>
<td align="left">Case=Nom|Derivation=Minen|Number=Sing</td>
<td align="left">1</td>
<td align="left">conj</td>
<td align="left">NA</td>
<td align="left">SpacesAfter=</td>
<td align="right">0.544</td>
<td align="left">Female</td>
<td align="left">Muu Etelä-Suomi</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="option-2-using-svydesign-object-in-data-exploration">Option 2: Using <code>svydesign</code> object in data
exploration<a class="anchor" aria-label="anchor" href="#option-2-using-svydesign-object-in-data-exploration"></a>
</h2>
<p>The <code>svydesign</code> object can be used to <em>add</em> weights
and other columns during data exploration.</p>
<p>First, let’s create formatted data without weights and additional
columns ready to use with our <code>svydesign</code> object.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/fst_prepare.html">fst_prepare</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dev_coop</span>,</span>
<span>                   question <span class="op">=</span> <span class="st">'q11_3'</span>,</span>
<span>                   id <span class="op">=</span> <span class="st">'fsd_id'</span>,</span>
<span>                   model <span class="op">=</span> <span class="st">'ftb'</span>,</span>
<span>                   stopword_list <span class="op">=</span> <span class="st">'nltk'</span>,</span>
<span>                   weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                   add_cols <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>Within the data analysis functions, there are 3 parameters (which are
in each function) which are used to add information from the
<code>svydesign</code> object. These are:</p>
<ul>
<li>
<code>use_svydesign_weights</code>: should be set as TRUE if we want
to use weights from within a svydesign object.</li>
<li>
<code>id</code>: only required if weights are coming from a
<code>svydesign</code> object</li>
<li>
<code>svydesign</code>: the <code>svydesign</code> object</li>
</ul>
<p>Within the initial functions (the ones which are <em>not</em> used
for comparison between groups) these are used to add weights from the
<code>svydesign</code> object.</p>
<p>For example,</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/fst_wordcloud.html">fst_wordcloud</a></span><span class="op">(</span><span class="va">df2</span>, </span>
<span>              pos_filter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NOUN"</span>, <span class="st">"VERB"</span>, <span class="st">"ADJ"</span>, <span class="st">"ADV"</span><span class="op">)</span>,</span>
<span>              max<span class="op">=</span><span class="fl">50</span>, </span>
<span>              use_svydesign_weights <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>              id <span class="op">=</span> <span class="st">'fsd_id'</span>, </span>
<span>              svydesign <span class="op">=</span> <span class="va">svy_d</span><span class="op">)</span></span></code></pre></div>
<p><img src="Extra-UseWithSurveyPackage_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../../reference/fst_freq.html">fst_freq</a></span><span class="op">(</span><span class="va">df2</span>,</span>
<span>         number <span class="op">=</span> <span class="fl">10</span>,</span>
<span>         norm <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>         pos_filter <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>         strict <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>         use_svydesign_weights <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         id <span class="op">=</span> <span class="st">"fsd_id"</span>,</span>
<span>         svydesign <span class="op">=</span> <span class="va">svy_d</span>,</span>
<span>         use_column_weights <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Extra-UseWithSurveyPackage_files/figure-html/unnamed-chunk-6-2.png" width="700"></p>
<p>Within the <strong>comparison functions</strong>, we have the
following additional parameter:</p>
<ul>
<li>
<code>use_svydesign_field</code>: set to TRUE if you want to get
<code>field</code> for splitting the data from the
<code>svydesign</code> object</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/fst_ngrams_compare.html">fst_ngrams_compare</a></span><span class="op">(</span><span class="va">fst_dev_coop_2</span>,</span>
<span>                   field <span class="op">=</span> <span class="st">'gender'</span>,</span>
<span>                   number <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                   ngrams <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                   norm <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                   pos_filter <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                   strict <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   use_svydesign_weights <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   use_svydesign_field <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   id <span class="op">=</span> <span class="st">"fsd_id"</span>,</span>
<span>                   svydesign <span class="op">=</span> <span class="va">svy_d</span>,</span>
<span>                   use_column_weights <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                   exclude_nulls <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   rename_nulls <span class="op">=</span> <span class="st">'null_data'</span>,</span>
<span>                   unique_colour <span class="op">=</span> <span class="st">"indianred"</span>,</span>
<span>                   title_size <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                   subtitle_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></code></pre></div>
<p><img src="Extra-UseWithSurveyPackage_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>All of these functions call the function
<code><a href="../../reference/fst_use_svydesign.html">fst_use_svydesign()</a></code> in the background to add the
<code>svydesign</code> data to your formatted dataframe.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># FUNCTION DEFINITION:</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>fst_use_svydesign <span class="ot">&lt;-</span> <span class="cf">function</span>(data,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>                              svydesign,</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>                              id,</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>                              <span class="at">add_cols =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>                              <span class="at">add_weights =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adeline Clarke, Krista Lagus, Katja Laine, Maria Litova, Matti Nelimarkka, Joni Oksanen, Jaakko Peltonen, Tuukka Oikarinen, Jani-Matti Tirkkonen, Ida Toivanen, Maria Valaste, DARIAH-FI.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
