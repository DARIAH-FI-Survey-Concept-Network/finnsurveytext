---
title: "Tutorial"
author: "Adeline Clarke"
date: "2024-05-22"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Overview of finnsurveytext
This tutorial aims to provide a simple overview of what is included within the `finnsurveytext` package and teach you how to use the main functions included in the package. 

The below table shows you all the functions that are included in the package. The functions which are **bolded** are the main functions which are outlined in the sections below. (**TO-DO** All the functions are described in detail in other vignettes named according to the 'Section' the function is from.)

| Section | Usage | Functions |
|:---:|---|---|
| **Data Preparation** | use the `udpipe` `R` package to clean and annotate the raw data into a standardised format (CoNLL-U) suitable for analysis. | fst_format()<br>fst_find_stopwords()<br>fst_rm_stop_punct()<br>**fst_prepare()**<br>**fst_prepare_svydesign()** |
| **Data Exploration** | create wordclouds, n-gram tables and summary tables for initial insights into trends across responses. | **fst_summarise_short()**<br>**fst_summarise()**<br>**fst_pos()**<br>**fst_length_summary()**<br>fst_use_svydesign()<br>fst_freq_table<br>fst_ngrams_table()<br>fst_ngrams_table2()<br>fst_freq_plot()<br>fst_ngrams_plot()<br>**fst_freq()**<br>**fst_ngrams()**<br>**fst_wordcloud()** |
| **Concept Network** | creation of a concept network using the `textrank` `R` package with node size indicating word importance (PageRank) <br>and edge weight showing co-occurrence of words. | fst_cn_search()<br>fst_cn_edges()<br>fst_cn_nodes()<br>fst_cn_plot()<br>**fst_concept_network()** |
| **Comparison Functions** | corresponding **Data Exploration** and **Concept Network** functions allowing for comparison between groups of survey respondents. | **fst_pos_compare()**<br>**fst_summarise_compare()**<br>**fst_length_compare()**<br>fst_get_unique_ngrams_separate()<br>fst_get_unique_ngrams()<br>fst_join_unique()<br>fst_ngrams_compare_plot()<br>**fst_freq_compare()**<br>**fst_ngrams_compare()**<br>**fst_comparison_cloud()**<br>fst_cn_get_unique_separate()<br>fst_cn_get_unique()<br>fst_cn_compare_plot()<br>**fst_concept_network_compare()** |

# https://www.tablesgenerator.com/markdown_tables

### Installation

First, the `finnsurveytext` package needs to be installed into your R environment and loaded into the environment.

```{r}
# install.packages('finnsurveytext') # Only required the first time you use the package! Uncomment this line to run it!
# library(finnsurveytext)

library(devtools)
load_all()
```

### Data Preparation

The data preparation functions are used to take your raw survey data (in a dataframe or *svydesign* object within your R environment) and convert it into a standardised format ready for analysis. The functions in the remaining sections require your data to be pre-formatted into this format. (To learn move about the format we use, see the [Universal Dependencies Project](https://universaldependencies.org/format.html).)

(To bring your raw survey data into the R environment, you can use `read.csv()` or `read.table()` for csvs/excel files which are functions included in R. See 'How to load data' section at the end of this page if you do not know how to do this.)

#### Option 1: Data is in dataframe

The package comes with sample data. For this demonstration, we use `dev_coop`. 

```{r}
load("~/2024/finnsurveytext_dev24/finnsurveytext/data/dev_coop.rda")
knitr::kable(head(dev_coop, 5))
```

We will look at q11_3 (responses to ''Jatka lausetta: Maailman kolme suurinta ongelmaa ovat... (Avokysymys)') as our open-ended survey question. We also want to include our survey weights (in 'paino' column) and bring in the genders and regions so we can compare these in the future. 

The main function here is `fst_prepare()`

```{r, eval = FALSE}
# FUNCTION DEFINITION
fst_prepare <- function(data,
                        question,
                        id,
                        model = "ftb",
                        stopword_list = "nltk",
                        weights = NULL,
                        add_cols = NULL,
                        manual = FALSE,
                        manual_list = "")
```

We can run the function as follows: 
```{r}
df <- fst_prepare(data = dev_coop,
                  question = 'q11_3', 
                  id = 'fsd_id', 
                  weights = 'paino',
                  add_cols = c('gender', 'region')
                  )
```


Summary of components

* `data` is the dataframe of interest. In this case, we are using data that comes with the package called 'dev_coop'.
* The `question` is the name of the column in your data which contains the open-ended survey question. In this example, we're considering 'q11_3'
* `id` is the id column in our data, which is 'fsd_id'
* The function also requires a Finnish language model available for `udpipe`, in this case we are using the default Finnish Treebank, `model = "ftb"`. (There are two options for Finnish langage model; the other option is the Turku Dependency Treebank "tdt".
* By default we will remove stopwords from the "nltk" `stopword_list` in this example. (To find the relevant lists of Finnish stopwords, you can run the `fst_rm_stopwords_punct()` function. Punctuation is also removed from the data whenever stopwords are removed.
* Optionally, you can add a `weights` column in your formatted data. Our weights are stored in the raw data as 'paino'. 
* Optionally, you can add other columns to your formatted data (for use in comparison functions). We include our 'gender' and 'region' columns for this reason
* The results in CoNLL-U format are stored in the local environment as `df`. 
* (`manual` and `manual_list` are used if you want to provide your own list of stopwords to remove from the data.) 

The formatted data looks like this: 
```{r}
knitr::kable(head(df, 5))
```


#### Option 2: Data is in a *svydesign* object

The other option is to get your data from a *svydesign* object from the **survey** package. The **survey** package is a popular package used for analysising surveys. 

```{r echo = FALSE}
svy_dev <- survey::svydesign(id = ~1, weights = ~paino, data =dev_coop)
```

The main function here is `fst_prepare_svydesign()`

```{r, eval = FALSE}
# FUNCTION DEFINITION
fst_prepare_svydesign <- function(svydesign,
                                  question,
                                  id,
                                  model = "ftb",
                                  stopword_list = "nltk",
                                  use_weights = TRUE,
                                  add_cols = NULL,
                                  manual = FALSE,
                                  manual_list = "") 
```

We can run the function as follows: 
```{r}
df2 <- fst_prepare_svydesign(svydesign = svy_dev,
                            question = 'q11_3', 
                            id = 'fsd_id', 
                            use_weights = TRUE,
                            add_cols = c('gender', 'region')
                            )
```

The only differences between the previous function and this one are: 

* `svydesign` is you *svydesign* object. In this case, we have one called 'svy_dev'
* The *svydesign* object has a component called 'prob' which contains the inverse of the weights. Therefore, we use these by setting `use_weights = TRUE`

The formatted data looks like this (should look very similar to the above formatted data!): 
```{r}
knitr::kable(head(df2, 5))
```

### Data
The package comes with sample data from two surveys obtained from the Finnish Social Science Data Archive: 

#### 1. Child Barometer Data
* Source: FSD3134 Lapsibarometri 2016
* Question: q7 'Kertoisitko, mitä sinun mielestäsi kiusaaminen on? (Avokysymys)'
* Licence: (A) openly available for all users without registration (CC BY 4.0).
* Link to Data: https://urn.fi/urn:nbn:fi:fsd:T-FSD3134

#### 2. Development Cooperation Data
* Source: FSD2821 Nuorten ajatuksia kehitysyhteistyöstä 2012
* Questions: q11_1 'Jatka lausetta: Kehitysmaa on maa, jossa... (Avokysymys)', q11_2 'Jatka lausetta: Kehitysyhteistyö on toimintaa, jossa... (Avokysymys)', q11_3 'Jatka lausetta: Maailman kolme suurinta ongelmaa ovat... (Avokysymys)'
* Licence: (A) openly available for all users without registration (CC BY 4.0).
* Link to Data: https://urn.fi/urn:nbn:fi:fsd:T-FSD2821 

### How to load data

**TO-DO**

